<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>GPC AI Logo</title>
    <meta name="description" content="GPC AI Logo - AI-powered workflow automation platform">
    <meta name="keywords" content="AI, workflow, automation, template">
    <meta name="author" content="GPC AI Team">
    
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&family=JetBrains+Mono:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Custom Styles -->
    <style>
        :root {
            --background: #000000;
            --foreground: #ffffff;
            --primary: #00ff00;
            --accent: #00ff00;
            --text-secondary: #9ca3af;
            --text-muted: #6b7280;
            --border: #333333;
        }

        * {
            box-sizing: border-box;
            padding: 0;
            margin: 0;
        }

        html, body {
            max-width: 100vw;
            overflow-x: hidden;
            background: var(--background);
            color: var(--foreground);
            font-family: 'Inter', system-ui, sans-serif;
            font-weight: 600;
        }

        /* Custom scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: #000000;
        }

        ::-webkit-scrollbar-thumb {
            background: #333333;
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #00ff00;
        }

        /* Selection */
        ::selection {
            background: rgba(0, 255, 0, 0.3);
            color: #ffffff;
        }

        /* Custom animations */
        @keyframes glow {
            0% { box-shadow: 0 0 20px rgba(0, 255, 0, 0.3); }
            100% { box-shadow: 0 0 30px rgba(0, 255, 0, 0.6); }
        }

        @keyframes fadeIn {
            0% { opacity: 0; }
            100% { opacity: 1; }
        }

        @keyframes slideUp {
            0% { transform: translateY(10px); opacity: 0; }
            100% { transform: translateY(0); opacity: 1; }
        }

        .animate-glow {
            animation: glow 2s ease-in-out infinite alternate;
        }

        .animate-fade-in {
            animation: fadeIn 0.5s ease-in-out;
        }

        .animate-slide-up {
            animation: slideUp 0.3s ease-out;
        }

        /* Custom utility classes */
        .bg-background { background-color: #000000 !important; }
        .bg-custom-dark-secondary { background-color: #000000 !important; }

        /* AI Message Formatting */
        .ai-message h1, .ai-message h2, .ai-message h3, .ai-message h4 {
            color: #00ff00 !important;
            margin: 15px 0 8px 0 !important;
            font-weight: 700 !important;
        }
        .ai-message h1 { font-size: 1.5em !important; }
        .ai-message h2 { font-size: 1.3em !important; }
        .ai-message h3 { font-size: 1.2em !important; }
        .ai-message h4 { font-size: 1.1em !important; }
        
        .ai-message ul, .ai-message ol {
            margin: 10px 0 !important;
            padding-left: 25px !important;
        }
        .ai-message li {
            margin: 6px 0 !important;
            line-height: 1.5 !important;
        }
        .ai-message strong {
            color: #00ff00 !important;
            font-weight: 700 !important;
        }
        .ai-message p {
            margin: 8px 0 !important;
            line-height: 1.6 !important;
        }
        .ai-message blockquote {
            border-left: 3px solid #00ff00 !important;
            padding-left: 15px !important;
            margin: 15px 0 !important;
            font-style: italic !important;
        }
        .bg-custom-dark-tertiary { background-color: #0a0a0a !important; }
        .bg-custom-dark { background-color: #0a0a0a !important; }
        .bg-accent { background-color: #00cc00; }
        .bg-primary-dark { background-color: #009900; }
        
        .text-text { color: #ffffff; }
        .text-text-secondary { color: #9ca3af; }
        .text-text-muted { color: #6b7280; }
        .text-accent { color: #00cc00; }
        
        .border-border { border-color: #333333; }
        .border-gray-700 { border-color: #00ff00; }
        
        .shadow-none { box-shadow: 0 0 20px rgba(0, 255, 0, 0.3); }
        .shadow-none-hover { box-shadow: 0 0 30px rgba(0, 255, 0, 0.5); }
        
        .rounded-xl { border-radius: 1rem; }
        .rounded-2xl { border-radius: 1.5rem; }
        .rounded-3xl { border-radius: 2rem; }

        /* Custom checkbox styling */
        input[type="checkbox"] {
            appearance: none;
            -webkit-appearance: none;
            -moz-appearance: none;
            width: 18px;
            height: 18px;
            border: 2px solid #333333;
            border-radius: 4px;
            background-color: #0a0a0a;
            cursor: pointer;
            position: relative;
            transition: all 0.2s ease-in-out;
        }

        input[type="checkbox"]:checked {
            background-color: #00cc00;
            border-color: #00cc00;
        }

        input[type="checkbox"]:checked::after {
            content: '✓';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: #000000;
            font-size: 12px;
            font-weight: bold;
        }

        input[type="checkbox"]:hover {
            border-color: #00cc00;
            box-shadow: 0 0 8px rgba(0, 204, 0, 0.3);
        }

        input[type="checkbox"]:focus {
            outline: none;
            border-color: #00cc00;
            box-shadow: 0 0 0 3px rgba(0, 204, 0, 0.2);
        }

        /* Group hover utilities */
        .group:hover .group-hover\:opacity-100 {
            opacity: 1;
        }

        /* Toggle animations */
        .rotate-180 {
            transform: rotate(180deg);
        }

        /* Mini menu positioning and styling */
        #miniMenu {
            position: absolute;
            bottom: calc(100% + 8px);
            left: 0;
            z-index: 9999;
            background-color: #0a0a0a;
            border: 1px solid #333333;
            box-shadow: 0 -10px 25px rgba(0, 0, 0, 0.8);
            min-width: 280px;
            transition: opacity 0.2s ease, transform 0.2s ease;
        }

        #miniMenu.hidden {
            opacity: 0;
            transform: translateY(10px);
            pointer-events: none;
        }

        #miniMenu:not(.hidden) {
            opacity: 1;
            transform: translateY(0);
        }

        /* Ensure mini menu appears above everything */
        #miniMenu {
            z-index: 9999 !important;
        }

        /* Mini menu content styling */
        #miniMenu .space-y-3 > div {
            transition: all 0.2s ease-in-out;
        }

        #miniMenu .space-y-3 > div:hover {
            transform: translateX(2px);
        }

        /* Smooth transitions for all interactive elements */
        #miniMenu button,
        #miniMenu input,
        #miniMenu select {
            transition: all 0.2s ease-in-out;
        }

        /* Ensure toggle buttons are clickable */
        #workflowsToggleBtn,
        #historyToggleBtn,
        #howToUseToggleBtn {
            pointer-events: auto !important;
            cursor: pointer !important;
            position: relative;
            z-index: 1;
            user-select: none;
        }

        /* Arrow rotation animation */
        .rotate-180 {
            transform: rotate(180deg);
        }

        /* Toggle button active state */
        .border-accent {
            border-color: #00cc00 !important;
        }

        /* Simple hidden class */
        .hidden {
            display: none;
        }

        /* File upload area visual feedback */
        #fileUploadArea.border-accent {
            border-color: #00cc00 !important;
        }

        #fileUploadArea.bg-accent\/5 {
            background-color: rgba(0, 204, 0, 0.05);
        }

        /* Ensure checkbox shows checked state */
        input[type="checkbox"]:checked {
            background-color: #00cc00 !important;
            border-color: #00cc00 !important;
        }

        input[type="checkbox"]:checked::after {
            content: '✓';
            display: block;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: #000000;
            font-size: 12px;
            font-weight: bold;
        }

        /* Sidebar collapse styles */
        #leftSidebar {
            position: relative;
        }

        #leftSidebar.collapsed {
            width: 0;
            padding: 0;
            border-right: none;
            overflow: hidden;
        }

        #sidebarToggleBtn {
            position: fixed;
            top: 104px;
            left: -3px;
            transition: left 0.3s ease-in-out;
            z-index: 1000;
        }

        #leftSidebar:not(.collapsed) #sidebarToggleBtn {
            left: 317px;
        }

        #leftSidebar.collapsed #sidebarArrow {
            transform: rotate(180deg);
        }

        /* Mobile Menu Modal */
        #mobileMenuModal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            z-index: 9999;
            display: none;
        }

        #mobileMenuModal.show {
            display: flex;
            align-items: flex-start;
            justify-content: flex-start;
            padding-top: 60px;
        }

        #mobileMenuContent {
            background: var(--background);
            width: 100%;
            max-width: 320px;
            height: calc(100vh - 60px);
            overflow-y: auto;
            border-right: 1px solid var(--border);
            padding: 1rem;
            transform: translateX(-100%);
            transition: transform 0.3s ease-in-out;
        }

        #mobileMenuModal.show #mobileMenuContent {
            transform: translateX(0);
        }

        /* Mobile Responsive Design */
        @media (max-width: 768px) {
            /* Header adjustments */
            header {
                height: 60px;
                padding: 0 1rem;
                position: relative;
            }
            
            header img {
                width: 48px;
                height: 48px;
            }
            
            /* Add hamburger menu button to header */
            .hamburger-menu {
                position: absolute;
                left: 1rem;
                top: 50%;
                transform: translateY(-50%);
                width: 24px;
                height: 24px;
                display: flex;
                flex-direction: column;
                justify-content: space-between;
                cursor: pointer;
                z-index: 1000;
            }
            
            .hamburger-line {
                width: 100%;
                height: 2px;
                background: var(--foreground);
                transition: all 0.3s ease;
            }
            
            .hamburger-menu.active .hamburger-line:nth-child(1) {
                transform: rotate(45deg) translate(5px, 5px);
            }
            
            .hamburger-menu.active .hamburger-line:nth-child(2) {
                opacity: 0;
            }
            
            .hamburger-menu.active .hamburger-line:nth-child(3) {
                transform: rotate(-45deg) translate(7px, -6px);
            }
            
            /* Hide desktop sidebar on mobile */
            #leftSidebar {
                display: none !important;
            }
            
            /* Main layout - full width on mobile */
            .flex.h-\[calc\(100vh-80px\)\] {
                height: calc(100vh - 60px);
            }
            
            /* Main chat area - full width */
            #mainChatArea {
                width: 100%;
            }
            
            /* Main chat area adjustments */
            #mainChatArea {
                height: calc(100vh - 60px);
                min-height: 50vh;
            }
            
            /* Chat messages padding */
            #chatMessages {
                padding: 1rem;
                padding-top: 2rem;
            }
            
            /* Input area adjustments */
            .p-6 {
                padding: 1rem;
            }
            
            /* Message bubbles - full width on mobile */
            .max-w-\[70\%\] {
                max-width: 90%;
            }
            
            /* Plus button positioning */
            #plusButton {
                bottom: 1rem;
                right: 1rem;
            }
            
            /* Mini menu adjustments */
            #miniMenu {
                bottom: calc(100% + 1rem);
                left: 0;
                right: 0;
                min-width: auto;
                width: calc(100vw - 2rem);
                margin: 0 1rem;
            }
            
            /* Settings and help modals */
            .max-w-md, .max-w-2xl {
                max-width: calc(100vw - 2rem);
                margin: 1rem;
            }
            
            /* Text sizing adjustments */
            .text-lg {
                font-size: 1rem;
            }
            
            .text-sm {
                font-size: 0.875rem;
            }
            
            /* Button sizing */
            .p-4 {
                padding: 0.75rem;
            }
            
            .p-3 {
                padding: 0.5rem;
            }
        }
        
        /* Small mobile devices */
        @media (max-width: 480px) {
            /* Even smaller adjustments */
            header {
                height: 50px;
            }
            
            header img {
                width: 40px;
                height: 40px;
            }
            
            .flex.h-\[calc\(100vh-80px\)\] {
                height: calc(100vh - 50px);
            }
            
            #sidebarToggleBtn {
                top: 60px;
            }
            
            #mainChatArea {
                height: calc(100vh - 50px);
            }
            
            /* Smaller text on very small screens */
            .text-base {
                font-size: 0.875rem;
            }
            
            /* Compact spacing */
            .space-y-4 > * + * {
                margin-top: 0.75rem;
            }
        }
    </style>
</head>
<body class="antialiased">
    <!-- Header -->
    <header class="h-20 bg-custom-dark-secondary border-b border-border flex items-center justify-center px-6 relative">
        <!-- Mobile Hamburger Menu Button -->
        <div class="hamburger-menu" onclick="toggleMobileMenu()">
            <div class="hamburger-line"></div>
            <div class="hamburger-line"></div>
            <div class="hamburger-line"></div>
        </div>
        
        <div class="flex items-center gap-4">
            <!-- Logo -->
            <img src="assets/gpc-ai-logo.png" alt="GPC AI Logo Design" class="w-24 h-24 rounded-2xl object-cover">            
        </div>
    </header>

    <!-- Mobile Menu Modal -->
    <div id="mobileMenuModal" onclick="closeMobileMenu()">
        <div id="mobileMenuContent" onclick="event.stopPropagation()">
            <!-- Workflows Section -->
            <div class="mb-6">
                <button 
                    onclick="toggleWorkflows()" 
                    class="flex items-center justify-between w-full text-left bg-custom-dark border border-border rounded-xl p-4 hover:border-gray-700 transition-all duration-200"
                    id="mobileWorkflowsToggleBtn"
                >
                    <div class="flex items-center space-x-3">
                        <svg class="w-6 h-6 text-accent" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v10a2 2 0 002 2h8a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path>
                        </svg>
                        <div>
                            <h3 class="text-lg font-semibold text-text">Workflows</h3>
                            <p class="text-text-secondary text-sm">Select a workflow to get started</p>
                            <span class="inline-block px-2 py-1 text-xs font-medium bg-accent/20 text-accent rounded-full mt-1">Coming Soon</span>
                        </div>
                    </div>
                    <svg id="mobileWorkflowsArrow" class="w-5 h-5 text-text-secondary transition-transform duration-200" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                    </svg>
                </button>
                
                <!-- Workflows Content -->
                <div id="mobileWorkflowsContent" class="mt-4 space-y-3 hidden">
                    <div id="mobileWorkflowsList">
                        <!-- Workflows will be populated by JavaScript -->
                    </div>
                    
                    <button class="w-full p-3 bg-accent text-black font-semibold rounded-xl hover:bg-primary-dark transition-colors duration-200 shadow-none hover:shadow-none-hover">
                        + New Workflow
                    </button>
                </div>
            </div>

            <!-- History Section -->
            <div class="mb-6">
                <button 
                    onclick="toggleMobileHistory()" 
                    class="flex items-center justify-between w-full text-left bg-custom-dark border border-border rounded-xl p-4 hover:border-gray-700 transition-all duration-200"
                    id="mobileHistoryToggleBtn"
                >
                    <div class="flex items-center space-x-3">
                        <svg class="w-6 h-6 text-accent" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                        </svg>
                        <div>
                            <h3 class="text-lg font-semibold text-text">History</h3>
                            <p class="text-text-secondary text-sm">Recent workflow executions</p>
                            <span class="inline-block px-2 py-1 text-xs font-medium bg-accent/20 text-accent rounded-full mt-1">Coming Soon</span>
                        </div>
                    </div>
                    <svg id="mobileHistoryArrow" class="w-5 h-5 text-text-secondary transition-transform duration-200" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                    </svg>
                </button>
                
                <!-- History Content -->
                <div id="mobileHistoryContent" class="mt-4 space-y-3 hidden">
                    <div id="mobileHistoryList">
                        <!-- History items will be populated by JavaScript -->
                    </div>
                    
                    <button class="w-full p-3 border border-border text-text-secondary font-medium rounded-xl hover:border-gray-700 hover:text-text transition-colors duration-200">
                        View All History
                    </button>
                </div>
            </div>

            <!-- How to Use Section -->
            <div class="mb-6">
                <button 
                    onclick="toggleMobileHowToUse()" 
                    class="flex items-center justify-between w-full text-left bg-custom-dark border border-border rounded-xl p-4 hover:border-gray-700 transition-all duration-200"
                    id="mobileHowToUseToggleBtn"
                >
                    <div class="flex items-center space-x-3">
                        <svg class="w-6 h-6 text-accent" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"></path>
                        </svg>
                        <div>
                            <h3 class="text-lg font-semibold text-text">How to Use</h3>
                            <p class="text-text-secondary text-sm">Get started with GPC AI</p>
                        </div>
                    </div>
                    <svg id="mobileHowToUseArrow" class="w-5 h-5 text-text-secondary transition-transform duration-200" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                    </svg>
                </button>
                
                <!-- How to Use Content -->
                <div id="mobileHowToUseContent" class="mt-4 space-y-3 hidden">
                    <div class="space-y-3">
                        <button onclick="toggleHelp(); closeMobileMenu();" class="w-full p-3 bg-accent text-black font-semibold rounded-xl hover:bg-primary-dark transition-colors duration-200">
                            📖 View Help Guide
                        </button>
                        <button onclick="toggleSettings(); closeMobileMenu();" class="w-full p-3 border border-border text-text-secondary font-medium rounded-xl hover:border-gray-700 hover:text-text transition-colors duration-200">
                            ⚙️ Settings
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <div class="flex h-[calc(100vh-80px)]">
        <!-- Left Control Center -->
        <div id="leftSidebar" class="w-80 bg-custom-dark-secondary border-r border-border p-6 transition-all duration-300 ease-in-out">
            <!-- Sidebar Toggle Button -->
            <button 
                onclick="toggleSidebar()" 
                class="w-6 h-6 bg-custom-dark-secondary border border-border rounded-full flex items-center justify-center hover:bg-custom-dark transition-all duration-200 z-10"
                id="sidebarToggleBtn"
            >
                <svg id="sidebarArrow" class="w-3 h-3 text-text-secondary transition-transform duration-200" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
                </svg>
            </button>
            <!-- Workflows Toggle -->
            <div class="mb-6">
                <button 
                    onclick="toggleWorkflows()" 
                    class="flex items-center justify-between w-full text-left bg-custom-dark border border-border rounded-xl p-4 hover:border-gray-700 transition-all duration-200"
                    id="workflowsToggleBtn"
                >
                    <div class="flex items-center space-x-3">
                        <svg class="w-6 h-6 text-accent" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v10a2 2 0 002 2h8a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path>
                        </svg>
                        <div>
                            <h3 class="text-lg font-semibold text-text">Workflows</h3>
                            <p class="text-text-secondary text-sm">Select a workflow to get started</p>
                            <span class="inline-block px-2 py-1 text-xs font-medium bg-accent/20 text-accent rounded-full mt-1">Coming Soon</span>
                        </div>
                    </div>
                    <svg id="workflowsArrow" class="w-5 h-5 text-text-secondary transition-transform duration-200" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                    </svg>
                </button>
                
                <!-- Workflows Content -->
                <div id="workflowsContent" class="mt-4 space-y-3 hidden">
                    <div id="workflowsList">
                        <!-- Workflows will be populated by JavaScript -->
                    </div>
                    
                    <button class="w-full p-3 bg-accent text-black font-semibold rounded-xl hover:bg-primary-dark transition-colors duration-200 shadow-none hover:shadow-none-hover">
                        + New Workflow
                    </button>
                </div>
            </div>

            <!-- History Toggle -->
            <div class="mb-6">
                <button 
                    onclick="toggleHistory()" 
                    class="flex items-center justify-between w-full text-left bg-custom-dark border border-border rounded-xl p-4 hover:border-gray-700 transition-all duration-200"
                    id="historyToggleBtn"
                >
                    <div class="flex items-center space-x-3">
                        <svg class="w-6 h-6 text-accent" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                        </svg>
                        <div>
                            <h3 class="text-lg font-semibold text-text">History</h3>
                            <p class="text-text-secondary text-sm">Recent workflow executions</p>
                            <span class="inline-block px-2 py-1 text-xs font-medium bg-accent/20 text-accent rounded-full mt-1">Coming Soon</span>
                        </div>
                    </div>
                    <svg id="historyArrow" class="w-5 h-5 text-text-secondary transition-transform duration-200" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                    </svg>
                </button>
                
                <!-- History Content -->
                <div id="historyContent" class="mt-4 space-y-3 hidden">
                    <div id="historyList">
                        <!-- History items will be populated by JavaScript -->
                    </div>
                    
                    <button class="w-full p-3 border border-border text-text-secondary font-medium rounded-xl hover:border-gray-700 hover:text-text transition-colors duration-200">
                        View All History
                    </button>
                </div>
            </div>

            <!-- How to Use Toggle -->
            <div class="mb-6">
                <button 
                    onclick="toggleHowToUse()" 
                    class="flex items-center justify-between w-full text-left bg-custom-dark border border-border rounded-xl p-4 hover:border-gray-700 transition-all duration-200"
                    id="howToUseToggleBtn"
                >
                    <div class="flex items-center space-x-3">
                        <svg class="w-6 h-6 text-accent" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"></path>
                        </svg>
                        <div>
                            <h3 class="text-lg font-semibold text-text">How to Use</h3>
                            <p class="text-text-secondary text-sm">Get started with GPC AI</p>
                        </div>
                    </div>
                    <svg id="howToUseArrow" class="w-5 h-5 text-text-secondary transition-transform duration-200" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                    </svg>
                </button>
                
                <!-- How to Use Content -->
                <div id="howToUseContent" class="mt-4 space-y-4 hidden">
                    <p class="text-text-secondary text-sm">
                        Get started with GPC AI in three simple steps:
                    </p>
                    
                    <div class="space-y-3">
                        <div class="p-3 bg-custom-dark rounded-lg border border-border">
                            <div class="flex items-center space-x-3">
                                <div class="text-2xl">📋</div>
                                <div>
                                    <h4 class="font-semibold text-text text-sm">Select a Workflow</h4>
                                    <p class="text-text-secondary text-xs">Choose from available workflows or create a new one.</p>
                                </div>
                            </div>
                        </div>
                        
                        <div class="p-3 bg-custom-dark rounded-lg border border-border">
                            <div class="flex items-center space-x-3">
                                <div class="text-2xl">💬</div>
                                <div>
                                    <h4 class="font-semibold text-text text-sm">Chat with AI</h4>
                                    <p class="text-text-secondary text-xs">Describe what you want to accomplish.</p>
                                </div>
                            </div>
                        </div>
                        
                        <div class="p-3 bg-custom-dark rounded-lg border border-border">
                            <div class="flex items-center space-x-3">
                                <div class="text-2xl">✅</div>
                                <div>
                                    <h4 class="font-semibold text-text text-sm">Review & Execute</h4>
                                    <p class="text-text-secondary text-xs">AI helps set up and execute your workflow.</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="p-3 bg-accent/10 border border-gray-700/20 rounded-lg">
                        <h4 class="font-semibold text-accent text-sm mb-2">💡 Pro Tips</h4>
                        <ul class="text-text-secondary text-xs space-y-1">
                            <li>• Be specific about your requirements</li>
                            <li>• Use workflow templates as starting points</li>
                            <li>• Check history to track progress</li>
                            <li>• AI learns from your usage patterns</li>
                        </ul>
                    </div>
                </div>
            </div>

            <!-- Quick Actions -->
            <div class="space-y-3">
                <button onclick="toggleSettings()" class="w-full p-3 bg-custom-dark border border-border text-text-secondary rounded-xl hover:border-gray-700 hover:text-text transition-all duration-200">
                    <div class="flex items-center space-x-3">
                        <svg class="w-5 h-5 text-accent" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"></path>
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                        </svg>
                        <span class="font-medium">Settings</span>
                    </div>
                </button>
                
                <button onclick="toggleHelp()" class="w-full p-3 bg-custom-dark border border-border text-text-secondary rounded-xl hover:border-gray-700 hover:text-text transition-all duration-200">
                    <div class="flex items-center space-x-3">
                        <svg class="w-5 h-5 text-accent" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                        </svg>
                        <span class="font-medium">Help & Support</span>
                    </div>
                </button>
            </div>
        </div>
        
        <!-- Main Chat Area -->
        <div id="mainChatArea" class="flex-1 flex flex-col transition-all duration-300 ease-in-out">
            <div class="flex-1 flex flex-col bg-custom-dark">
                <!-- Messages -->
                <div class="flex-1 overflow-y-auto px-6 pt-8 pb-6 space-y-4" id="chatMessages">
                    <!-- Messages will be populated by JavaScript -->
                </div>

                <!-- Input Area -->
                <div class="p-6 border-t border-border">
                    <div class="flex gap-3">
                        <!-- Plus Button Container with Relative Positioning -->
                        <div class="relative">
                            <!-- Plus Button for Mini Menu -->
                            <button
                                onclick="toggleMiniMenu()"
                                class="flex-shrink-0 p-3 bg-custom-dark border border-border rounded-xl hover:border-gray-700 transition-all duration-200 group"
                                id="plusButton"
                            >
                                <svg class="w-6 h-6 text-text-secondary group-hover:text-accent transition-colors duration-200" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
                                </svg>
                            </button>

                            <!-- Mini Menu -->
                            <div id="miniMenu" class="absolute bottom-full left-0 mb-2 bg-custom-dark-secondary border border-border rounded-xl shadow-2xl p-4 hidden z-[9999] min-w-64 transform -translate-y-1">
                            <div class="space-y-3">
                                <!-- AI Model Selector -->
                                <div>
                                    <label class="block text-text-secondary text-xs font-medium mb-2">AI Model</label>
                                    <select id="modelSelector" class="w-full bg-custom-dark border border-border text-text rounded-lg px-3 py-2 text-sm focus:outline-none focus:border-gray-700 focus:ring-1 focus:ring-gray-600 transition-all duration-200">
                                        <option value="gpt-4">GPT-4</option>
                                        <option value="gpt-3.5-turbo">GPT-3.5 Turbo</option>
                                        <option value="claude">Claude 3 Sonnet</option>
                                    </select>
                                </div>

                                <!-- Knowledge Base Status -->
                                <div class="flex items-center justify-between">
                                    <label class="text-text-secondary text-xs font-medium">Knowledge Base</label>
                                    <div class="flex items-center space-x-2">
                                        <div class="w-2 h-2 bg-accent rounded-full animate-pulse"></div>
                                        <span class="text-accent text-xs font-medium">Always Active</span>
                                    </div>
                                </div>

                                <!-- File Upload -->
                                <div>
                                    <label class="block text-text-secondary text-xs font-medium mb-2">Upload File</label>
                                    <!-- Hidden file input -->
                                    <input 
                                        type="file" 
                                        id="fileInput" 
                                        class="hidden" 
                                        accept=".pdf,.doc,.docx,.txt,.csv,.json"
                                        onchange="handleFileSelect(event)"
                                        multiple
                                    >
                                    <!-- Clickable upload area -->
                                    <div 
                                        onclick="document.getElementById('fileInput').click()"
                                        ondrop="handleFileDrop(event)"
                                        ondragover="handleDragOver(event)"
                                        ondragleave="handleDragLeave(event)"
                                        id="fileUploadArea"
                                        class="border-2 border-dashed border-border rounded-lg p-3 text-center hover:border-gray-700 transition-colors duration-200 cursor-pointer"
                                    >
                                        <svg class="w-6 h-6 text-text-secondary mx-auto mb-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"></path>
                                        </svg>
                                        <span class="text-text-secondary text-sm" id="fileUploadText">Click to upload or drag & drop</span>
                                        <div id="selectedFiles" class="mt-2 text-xs text-accent"></div>
                                    </div>
                                </div>

                                <!-- Image Upload -->
                                <div>
                                    <label class="block text-text-secondary text-xs font-medium mb-2">Upload Image</label>
                                    <!-- Hidden image input -->
                                    <input 
                                        type="file" 
                                        id="imageInput" 
                                        class="hidden" 
                                        accept="image/*"
                                        onchange="handleImageSelect(event)"
                                    >
                                    <!-- Clickable image upload area -->
                                    <div 
                                        onclick="document.getElementById('imageInput').click()"
                                        id="imageUploadArea"
                                        class="border-2 border-dashed border-border rounded-lg p-3 text-center hover:border-gray-700 transition-colors duration-200 cursor-pointer"
                                    >
                                        <svg class="w-6 h-6 text-text-secondary mx-auto mb-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                                        </svg>
                                        <span class="text-text-secondary text-sm">📷 Upload Screenshot</span>
                                        <div class="text-text-muted text-xs mt-1">Analyze analytics, dashboards, performance data</div>
                                    </div>
                                </div>

                                <!-- Close Button -->
                                <button
                                    onclick="toggleMiniMenu()"
                                    class="w-full p-2 bg-custom-dark border border-border text-text-secondary rounded-lg hover:border-gray-700 hover:text-text transition-all duration-200 text-sm"
                                >
                                    Close
                                </button>
                            </div>
                        </div>
                        </div>

                        <!-- Chat Input -->
                        <div class="flex-1 relative">
                            <textarea
                                id="chatInput"
                                placeholder="Type your message here..."
                                class="w-full p-4 pr-12 bg-custom-dark-secondary border border-border rounded-xl text-text placeholder-text-muted resize-none focus:outline-none focus:border-gray-700 focus:ring-1 focus:ring-gray-600 transition-all duration-200"
                                rows="3"
                                onkeypress="handleKeyPress(event)"
                            ></textarea>
                            <button
                                onclick="sendMessage()"
                                class="absolute right-3 bottom-3 p-2 bg-accent text-black rounded-lg hover:bg-primary-dark transition-colors duration-200"
                            >
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8"></path>
                                </svg>
                            </button>
                        </div>
                    </div>
                </div>
            </div>


        </div>

        <!-- Settings Modal -->
        <div id="settingsModal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50">
            <div class="flex items-center justify-center min-h-screen p-4">
                <div class="bg-custom-dark-secondary border border-border rounded-2xl p-6 max-w-md w-full max-h-[80vh] overflow-y-auto">
                    <div class="flex items-center justify-between mb-6">
                        <h3 class="text-xl font-bold text-text">Settings</h3>
                        <button onclick="toggleSettings()" class="text-text-secondary hover:text-text transition-colors duration-200">
                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                            </svg>
                        </button>
                    </div>
                    
                    <div class="space-y-6">
                        <!-- Theme Settings -->
                        <div>
                            <h4 class="font-semibold text-text mb-3">Theme</h4>
                            <div class="flex items-center space-x-3">
                                <button class="px-4 py-2 bg-accent text-black rounded-lg font-medium">Dark Mode</button>
                                <button class="px-4 py-2 bg-custom-dark border border-border text-text-secondary rounded-lg hover:border-gray-700">Light Mode</button>
                            </div>
                        </div>

                        <!-- Notification Preferences -->
                        <div>
                            <h4 class="font-semibold text-text mb-3">Notifications</h4>
                            <div class="space-y-3">
                                <label class="flex items-center space-x-3">
                                    <input type="checkbox" checked class="w-4 h-4 rounded border-border bg-custom-dark text-accent focus:ring-2 focus:ring-accent">
                                    <span class="text-text-secondary text-sm">Workflow completion alerts</span>
                                </label>
                                <label class="flex items-center space-x-3">
                                    <input type="checkbox" checked class="w-4 h-4 rounded border-border bg-custom-dark text-accent focus:ring-2 focus:ring-accent">
                                    <span class="text-text-secondary text-sm">AI response notifications</span>
                                </label>
                            </div>
                        </div>

                        <!-- API Configuration -->
                        <div>
                            <h4 class="font-semibold text-text mb-3">API Configuration</h4>
                            <div class="space-y-3">
                                <div>
                                    <label class="block text-text-secondary text-sm mb-1">OpenAI API Key</label>
                                    <input type="password" placeholder="sk-..." class="w-full p-2 bg-custom-dark border border-border rounded-lg text-text text-sm focus:outline-none focus:border-gray-700">
                                </div>
                                <div>
                                    <label class="block text-text-secondary text-sm mb-1">Claude API Key</label>
                                    <input type="password" placeholder="sk-ant-..." class="w-full p-2 bg-custom-dark border border-border rounded-lg text-text text-sm focus:outline-none focus:border-gray-700">
                                </div>
                            </div>
                        </div>

                        <!-- Save Button -->
                        <button class="w-full p-3 bg-accent text-black font-semibold rounded-xl hover:bg-primary-dark transition-colors duration-200">
                            Save Settings
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Help Modal -->
        <div id="helpModal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50">
            <div class="flex items-center justify-center min-h-screen p-4">
                <div class="bg-custom-dark-secondary border border-border rounded-2xl p-6 max-w-2xl w-full max-h-[80vh] overflow-y-auto">
                    <div class="flex items-center justify-between mb-6">
                        <h3 class="text-xl font-bold text-text">Help & Support</h4>
                        <button onclick="toggleHelp()" class="text-text-secondary hover:text-text transition-colors duration-200">
                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                            </svg>
                        </button>
                    </div>
                    
                    <div class="space-y-6">
                        <!-- FAQ Section -->
                        <div>
                            <h4 class="font-semibold text-text mb-3">Frequently Asked Questions</h4>
                            <div class="space-y-3">
                                <details class="bg-custom-dark border border-border rounded-lg">
                                    <summary class="p-3 cursor-pointer text-text-secondary hover:text-text">How do I create a new workflow?</summary>
                                    <div class="p-3 border-t border-border text-text-secondary text-sm">
                                        Click the "+ New Workflow" button in the left sidebar, then describe what you want to accomplish in the chat area.
                                    </div>
                                </details>
                                <details class="bg-custom-dark border border-border rounded-lg">
                                    <summary class="p-3 cursor-pointer text-text-secondary hover:text-text">How do I switch between AI models?</summary>
                                    <div class="p-3 border-t border-border text-text-secondary text-sm">
                                        Click the + button next to the chat input, then select your preferred AI model from the dropdown menu.
                                    </div>
                                </details>
                            </div>
                        </div>

                        <!-- Contact Support -->
                        <div>
                            <h4 class="font-semibold text-text mb-3">Contact Support</h4>
                            <div class="space-y-3">
                                <input type="email" placeholder="Your email" class="w-full p-2 bg-custom-dark border border-border rounded-lg text-text text-sm focus:outline-none focus:border-gray-700">
                                <textarea placeholder="Describe your issue..." rows="3" class="w-full p-2 bg-custom-dark border border-border rounded-lg text-text text-sm focus:outline-none focus:border-gray-700 resize-none"></textarea>
                                <button class="px-4 py-2 bg-accent text-black font-semibold rounded-lg hover:bg-primary-dark transition-colors duration-200">
                                    Send Message
                                </button>
                            </div>
                        </div>

                        <!-- Documentation Links -->
                        <div>
                            <h4 class="font-semibold text-text mb-3">Documentation</h4>
                            <div class="space-y-2">
                                <a href="#" class="block text-accent hover:text-primary-dark transition-colors duration-200">Getting Started Guide</a>
                                <a href="#" class="block text-accent hover:text-primary-dark transition-colors duration-200">API Documentation</a>
                                <a href="#" class="block text-accent hover:text-primary-dark transition-colors duration-200">Workflow Examples</a>
                                <a href="#" class="block text-accent hover:text-primary-dark transition-colors duration-200">Keyboard Shortcuts</a>
                            </div>
                        </div>

                        <!-- Keyboard Shortcuts -->
                        <div>
                            <h4 class="font-semibold text-text mb-3">Keyboard Shortcuts</h4>
                            <div class="grid grid-cols-2 gap-3 text-sm">
                                <div class="flex justify-between">
                                    <span class="text-text-secondary">Send message:</span>
                                    <kbd class="px-2 py-1 bg-custom-dark border border-border rounded text-text-secondary">Enter</kbd>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-text-secondary">New line:</span>
                                    <kbd class="px-2 py-1 bg-custom-dark border border-border rounded text-text-secondary">Shift+Enter</kbd>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-text-secondary">Toggle workflows:</span>
                                    <kbd class="px-2 py-3 bg-custom-dark border border-border rounded text-text-secondary">Ctrl+W</kbd>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-text-secondary">Toggle history:</span>
                                    <kbd class="px-2 py-1 bg-custom-dark border border-border rounded text-text-secondary">Ctrl+H</kbd>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

    <!-- API Client -->
    <script src="js/api-client.js"></script>
    
    <!-- JavaScript -->
    <script>


        // Sample data
        const workflows = [
            {
                id: '1',
                name: 'Content Generation',
                description: 'Automated content creation workflow',
                status: 'active'
            },
            {
                id: '2',
                name: 'Data Processing',
                description: 'ETL pipeline for data analysis',
                status: 'active'
            },
            {
                id: '3',
                name: 'Email Automation',
                description: 'Customer communication workflow',
                status: 'draft'
            },
            {
                id: '4',
                name: 'Report Generation',
                description: 'Weekly analytics reports',
                status: 'inactive'
            }
        ];

        const history = [
            {
                id: '1',
                title: 'Content generation for Q4 campaign',
                timestamp: '2 hours ago',
                workflow: 'Content Generation',
                status: 'completed'
            },
            {
                id: '2',
                title: 'Data processing for user analytics',
                timestamp: '1 day ago',
                workflow: 'Data Processing',
                status: 'completed'
            },
            {
                id: '3',
                title: 'Email automation setup',
                timestamp: '3 days ago',
                workflow: 'Email Automation',
                status: 'failed'
            },
            {
                id: '4',
                title: 'Weekly report generation',
                timestamp: '1 week ago',
                workflow: 'Report Generation',
                status: 'completed'
            }
        ];

        let messages = [
            {
                id: '1',
                type: 'ai',
                content: 'Hello! I\'m your AI assistant for GPC. I can help you with workflow automation, content generation, data processing, and more. I have access to your knowledge base with 69 documents about TikTok strategies, dropshipping, marketing, and more. All my answers will be based on your uploaded content. What would you like to work on today?',
                timestamp: new Date()
            }
        ];

        let selectedWorkflow = '1';

        // Initialize API client
        const apiClient = new APIClient();
        
        // Initialize the app
        document.addEventListener('DOMContentLoaded', function() {
            renderWorkflows();
            renderHistory();
            renderMessages();
            
            // Close mini menu when clicking outside
            document.addEventListener('click', function(event) {
                const miniMenu = document.getElementById('miniMenu');
                const plusButton = document.getElementById('plusButton');
                
                if (!miniMenu.contains(event.target) && !plusButton.contains(event.target)) {
                    if (!miniMenu.classList.contains('hidden')) {
                        toggleMiniMenu();
                    }
                }
            });

            // Close modals when clicking outside
            document.addEventListener('click', function(event) {
                const settingsModal = document.getElementById('settingsModal');
                const helpModal = document.getElementById('helpModal');
                const miniMenu = document.getElementById('miniMenu');
                const plusButton = document.getElementById('plusButton');
                const workflowsBtn = document.getElementById('workflowsToggleBtn');
                const historyBtn = document.getElementById('historyToggleBtn');
                const howToUseBtn = document.getElementById('howToUseToggleBtn');
                
                // Don't interfere with workflow/history/how-to-use buttons
                if (workflowsBtn && workflowsBtn.contains(event.target)) return;
                if (historyBtn && historyBtn.contains(event.target)) return;
                if (howToUseBtn && howToUseBtn.contains(event.target)) return;
                
                // Close settings modal if clicking outside
                if (settingsModal && !settingsModal.contains(event.target) && !event.target.closest('[onclick="toggleSettings()"]')) {
                    if (!settingsModal.classList.contains('hidden')) {
                        toggleSettings();
                    }
                }
                
                // Close help modal if clicking outside
                if (helpModal && !helpModal.contains(event.target) && !event.target.closest('[onclick="toggleHelp()"]')) {
                    if (!helpModal.classList.contains('hidden')) {
                        toggleHelp();
                    }
                }

                // If clicking outside both the mini menu and plus button, close the menu
                if (miniMenu && plusButton && !miniMenu.contains(event.target) && !plusButton.contains(event.target)) {
                    miniMenu.classList.add('hidden');
                    plusButton.classList.remove('border-accent', 'bg-accent/10');
                }
            });

        });

        // Workflows toggle functionality
        function toggleWorkflows() {
            console.log('toggleWorkflows called');
            const workflowsContent = document.getElementById('workflowsContent');
            const workflowsArrow = document.getElementById('workflowsArrow');
            const workflowsToggleBtn = document.getElementById('workflowsToggleBtn');
            
            if (!workflowsContent) {
                console.error('workflowsContent not found!');
                return;
            }
            
            // Simple toggle
            if (workflowsContent.classList.contains('hidden')) {
                workflowsContent.classList.remove('hidden');
                if (workflowsArrow) workflowsArrow.classList.add('rotate-180');
                if (workflowsToggleBtn) workflowsToggleBtn.classList.add('border-accent');
                console.log('Workflows opened');
            } else {
                workflowsContent.classList.add('hidden');
                if (workflowsArrow) workflowsArrow.classList.remove('rotate-180');
                if (workflowsToggleBtn) workflowsToggleBtn.classList.remove('border-accent');
                console.log('Workflows closed');
            }
        }

        // History toggle functionality
        function toggleHistory() {
            console.log('toggleHistory called');
            const historyContent = document.getElementById('historyContent');
            const historyArrow = document.getElementById('historyArrow');
            const historyToggleBtn = document.getElementById('historyToggleBtn');
            
            if (!historyContent) {
                console.error('historyContent not found!');
                return;
            }
            
            // Simple toggle
            if (historyContent.classList.contains('hidden')) {
                historyContent.classList.remove('hidden');
                if (historyArrow) historyArrow.classList.add('rotate-180');
                if (historyToggleBtn) historyToggleBtn.classList.add('border-accent');
                console.log('History opened');
            } else {
                historyContent.classList.add('hidden');
                if (historyArrow) historyArrow.classList.remove('rotate-180');
                if (historyToggleBtn) historyToggleBtn.classList.remove('border-accent');
                console.log('History closed');
            }
        }

        // How to Use toggle functionality
        function toggleHowToUse() {
            console.log('toggleHowToUse called');
            const howToUseContent = document.getElementById('howToUseContent');
            const howToUseArrow = document.getElementById('howToUseArrow');
            const howToUseToggleBtn = document.getElementById('howToUseToggleBtn');
            
            if (!howToUseContent) {
                console.error('howToUseContent not found!');
                return;
            }
            
            if (howToUseContent.classList.contains('hidden')) {
                howToUseContent.classList.remove('hidden');
                if (howToUseArrow) howToUseArrow.classList.add('rotate-180');
                if (howToUseToggleBtn) howToUseToggleBtn.classList.add('border-accent');
                console.log('How to Use opened');
            } else {
                howToUseContent.classList.add('hidden');
                if (howToUseArrow) howToUseArrow.classList.remove('rotate-180');
                if (howToUseToggleBtn) howToUseToggleBtn.classList.remove('border-accent');
                console.log('How to Use closed');
            }
        }

        // Mini Menu toggle functionality
        function toggleMiniMenu() {
            const miniMenu = document.getElementById('miniMenu');
            const plusButton = document.getElementById('plusButton');
            
            if (miniMenu.classList.contains('hidden')) {
                // Show menu
                miniMenu.classList.remove('hidden');
                plusButton.classList.add('border-accent', 'bg-accent/10');
            } else {
                // Hide menu
                miniMenu.classList.add('hidden');
                plusButton.classList.remove('border-accent', 'bg-accent/10');
            }
        }



        // File selection handler
        function handleFileSelect(event) {
            const files = event.target.files;
            displaySelectedFiles(files);
        }

        // Drag and drop handlers
        function handleFileDrop(event) {
            event.preventDefault();
            event.stopPropagation();
            
            const uploadArea = document.getElementById('fileUploadArea');
            uploadArea.classList.remove('border-accent', 'bg-accent/5');
            
            const files = event.dataTransfer.files;
            displaySelectedFiles(files);
        }

        function handleDragOver(event) {
            event.preventDefault();
            event.stopPropagation();
            
            const uploadArea = document.getElementById('fileUploadArea');
            uploadArea.classList.add('border-accent', 'bg-accent/5');
        }

        function handleDragLeave(event) {
            event.preventDefault();
            event.stopPropagation();
            
            const uploadArea = document.getElementById('fileUploadArea');
            uploadArea.classList.remove('border-accent', 'bg-accent/5');
        }

        // Display selected files
        function displaySelectedFiles(files) {
            const selectedFilesDiv = document.getElementById('selectedFiles');
            const fileUploadText = document.getElementById('fileUploadText');
            
            if (files.length > 0) {
                const fileNames = Array.from(files).map(file => file.name).join(', ');
                selectedFilesDiv.textContent = `Selected: ${fileNames}`;
                fileUploadText.textContent = 'Click to change files';
                
                // Here you can add logic to actually upload the files
                console.log('Files selected:', files);
                
                // Example: Process each file
                Array.from(files).forEach(file => {
                    console.log(`File: ${file.name}, Size: ${file.size} bytes, Type: ${file.type}`);
                    // Add your file processing logic here
                });
            } else {
                selectedFilesDiv.textContent = '';
                fileUploadText.textContent = 'Click to upload or drag & drop';
            }
        }

        // File type validation
        function validateFileType(file) {
            const allowedTypes = [
                'application/pdf',
                'application/msword',
                'application/vnd.openxmlformats-officedocument.wordprocessingml.document',
                'text/plain',
                'text/csv',
                'application/json'
            ];
            
            return allowedTypes.includes(file.type) || 
                   file.name.endsWith('.pdf') || 
                   file.name.endsWith('.doc') || 
                   file.name.endsWith('.docx') || 
                   file.name.endsWith('.txt') || 
                   file.name.endsWith('.csv') || 
                   file.name.endsWith('.json');
        }

        // Test functions for debugging
        function testWorkflowsClick() {
            alert('Workflows button clicked!');
            toggleWorkflows();
        }

        function testHistoryClick() {
            alert('History button clicked!');
            toggleHistory();
        }

        function testHowToUseClick() {
            alert('How to Use button clicked!');
            toggleHowToUse();
        }

        // Debug function to check element states
        function debugCheckElements() {
            const elements = {
                workflowsContent: document.getElementById('workflowsContent'),
                historyContent: document.getElementById('historyContent'),
                howToUseContent: document.getElementById('howToUseContent')
            };
            
            console.log('=== ELEMENT DEBUG ===');
            for (let [name, element] of Object.entries(elements)) {
                if (element) {
                    console.log(`${name}:`, {
                        exists: true,
                        hidden: element.classList.contains('hidden'),
                        display: window.getComputedStyle(element).display,
                        visibility: window.getComputedStyle(element).visibility,
                        opacity: window.getComputedStyle(element).opacity,
                        classes: element.className
                    });
                } else {
                    console.log(`${name}: NOT FOUND`);
                }
            }
        }

        // Make debug function globally accessible
        window.debugCheckElements = debugCheckElements;

        // Update handleFileSelect to include validation
        function handleFileSelect(event) {
            const files = event.target.files;
            const validFiles = Array.from(files).filter(validateFileType);
            
            if (validFiles.length < files.length) {
                alert('Some files were not accepted. Please upload PDF, DOC, DOCX, TXT, CSV, or JSON files only.');
            }
            
            displaySelectedFiles(validFiles);
        }

        // Image selection handler
        function handleImageSelect(event) {
            const file = event.target.files[0];
            if (file) {
                // Validate image file
                if (!file.type.startsWith('image/')) {
                    alert('Please select a valid image file.');
                    return;
                }
                
                // Create a preview and send the image for analysis
                const reader = new FileReader();
                reader.onload = function(e) {
                    // Add the image to the chat
                    addImageToChat(e.target.result, file.name);
                    
                    // Close the mini menu
                    toggleMiniMenu();
                };
                reader.readAsDataURL(file);
            }
        }

        // Add image to chat and send for analysis
        function addImageToChat(imageData, fileName) {
            const messageInput = document.getElementById('messageInput');
            const currentMessage = messageInput.value.trim();
            
            // Create a message with the image
            const message = {
                id: Date.now().toString(),
                type: 'user',
                content: currentMessage || '📷 Analyzing image...',
                timestamp: new Date(),
                image: imageData,
                fileName: fileName
            };
            
            // Add to messages array
            messages.push(message);
            
            // Clear the input
            messageInput.value = '';
            
            // Render the message
            renderMessages();
            
            // Send for analysis
            sendImageForAnalysis(imageData, currentMessage);
        }

        // Send image for AI analysis
        async function sendImageForAnalysis(imageData, userMessage = '') {
            try {
                // Show thinking indicator
                showThinkingIndicator();
                
                // Get selected model
                const modelSelector = document.getElementById('modelSelector');
                const model = modelSelector ? modelSelector.value : 'gpt-4';
                
                // Send to API with image directly
                const result = await getAIResponseWithImage(userMessage || 'Please analyze this image and provide insights.', imageData, model);
                
                // Hide thinking indicator
                hideThinkingIndicator();
                
                // Add AI response
                const aiResponse = {
                    id: (Date.now() + 2).toString(),
                    type: 'ai',
                    content: result.response,
                    timestamp: new Date(),
                    sources: result.sources || []
                };
                
                messages.push(aiResponse);
                renderMessages();
                
            } catch (error) {
                console.error('Error analyzing image:', error);
                
                // Hide thinking indicator
                hideThinkingIndicator();
                
                // Add error message
                const errorResponse = {
                    id: (Date.now() + 2).toString(),
                    type: 'ai',
                    content: 'Sorry, I encountered an error analyzing your image. Please try again.',
                    timestamp: new Date()
                };
                
                messages.push(errorResponse);
                renderMessages();
            }
        }

        // Settings Modal toggle functionality
        function toggleSettings() {
            const settingsModal = document.getElementById('settingsModal');
            
            if (settingsModal.classList.contains('hidden')) {
                settingsModal.classList.remove('hidden');
            } else {
                settingsModal.classList.add('hidden');
            }
        }

        // Help Modal toggle functionality
        function toggleHelp() {
            const helpModal = document.getElementById('helpModal');
            
            if (helpModal.classList.contains('hidden')) {
                helpModal.classList.remove('hidden');
            } else {
                helpModal.classList.add('hidden');
            }
        }

        // Sidebar toggle functionality
        function toggleSidebar() {
            const sidebar = document.getElementById('leftSidebar');
            
            if (sidebar.classList.contains('collapsed')) {
                // Expand sidebar
                sidebar.classList.remove('collapsed');
                console.log('Sidebar expanded');
            } else {
                // Collapse sidebar
                sidebar.classList.add('collapsed');
                console.log('Sidebar collapsed');
            }
        }

        // Mobile menu functionality
        function toggleMobileMenu() {
            const modal = document.getElementById('mobileMenuModal');
            const hamburger = document.querySelector('.hamburger-menu');
            
            if (modal.classList.contains('show')) {
                closeMobileMenu();
            } else {
                modal.classList.add('show');
                hamburger.classList.add('active');
                document.body.style.overflow = 'hidden'; // Prevent background scrolling
            }
        }

        function closeMobileMenu() {
            const modal = document.getElementById('mobileMenuModal');
            const hamburger = document.querySelector('.hamburger-menu');
            
            modal.classList.remove('show');
            hamburger.classList.remove('active');
            document.body.style.overflow = ''; // Restore scrolling
        }

        // Mobile-specific toggle functions
        function toggleMobileHistory() {
            const content = document.getElementById('mobileHistoryContent');
            const arrow = document.getElementById('mobileHistoryArrow');
            
            if (content.classList.contains('hidden')) {
                content.classList.remove('hidden');
                arrow.style.transform = 'rotate(180deg)';
            } else {
                content.classList.add('hidden');
                arrow.style.transform = 'rotate(0deg)';
            }
        }

        function toggleMobileHowToUse() {
            const content = document.getElementById('mobileHowToUseContent');
            const arrow = document.getElementById('mobileHowToUseArrow');
            
            if (content.classList.contains('hidden')) {
                content.classList.remove('hidden');
                arrow.style.transform = 'rotate(180deg)';
            } else {
                content.classList.add('hidden');
                arrow.style.transform = 'rotate(0deg)';
            }
        }



        // Render workflows
        function renderWorkflows() {
            const workflowsList = document.getElementById('workflowsList');
            workflowsList.innerHTML = workflows.map(workflow => `
                <div
                    class="p-4 rounded-xl border cursor-pointer transition-all duration-200 hover:shadow-none-hover ${
                        selectedWorkflow === workflow.id
                            ? 'border-gray-700 bg-custom-dark-tertiary shadow-none'
                            : 'border-border bg-custom-dark hover:border-gray-700'
                    }"
                    onclick="selectWorkflow('${workflow.id}')"
                >
                    <div class="flex items-start justify-between mb-2">
                        <h3 class="font-semibold text-text">${workflow.name}</h3>
                        <span class="text-xs font-medium px-2 py-1 rounded-full bg-custom-dark ${getStatusColor(workflow.status)}">
                            ${workflow.status}
                        </span>
                    </div>
                    <p class="text-text-secondary text-sm">${workflow.description}</p>
                </div>
            `).join('');
        }

        // Render history
        function renderHistory() {
            const historyList = document.getElementById('historyList');
            historyList.innerHTML = history.map(item => `
                <div class="p-4 rounded-xl border border-border bg-custom-dark hover:border-gray-700 transition-all duration-200 cursor-pointer">
                    <div class="flex items-start justify-between mb-2">
                        <h3 class="font-semibold text-text text-sm leading-tight">${item.title}</h3>
                        <span class="text-xs font-medium px-2 py-1 rounded-full bg-custom-dark ${getStatusColor(item.status)}">
                            ${getStatusIcon(item.status)}
                        </span>
                    </div>
                    <div class="text-text-secondary text-xs space-y-1">
                        <p>${item.workflow}</p>
                        <p>${item.timestamp}</p>
                    </div>
                </div>
            `).join('');
        }

        // Format AI response text with proper HTML formatting
        function formatAIResponse(text) {
            return text
                // Convert **bold** to <strong>
                .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
                // Convert *italic* to <em>
                .replace(/\*(.*?)\*/g, '<em>$1</em>')
                // Convert ### Headers to <h3>
                .replace(/^### (.*$)/gm, '<h3>$1</h3>')
                // Convert ## Headers to <h2>
                .replace(/^## (.*$)/gm, '<h2>$1</h2>')
                // Convert # Headers to <h1>
                .replace(/^# (.*$)/gm, '<h1>$1</h1>')
                // Convert numbered lists
                .replace(/^(\d+)\. (.*$)/gm, '<li>$2</li>')
                // Convert bullet points
                .replace(/^[-*] (.*$)/gm, '<li>$1</li>')
                // Wrap consecutive <li> elements in <ul>
                .replace(/(<li>.*<\/li>)/gs, '<ul>$1</ul>')
                // Convert line breaks to <br>
                .replace(/\n/g, '<br>')
                // Convert blockquotes
                .replace(/^> (.*$)/gm, '<blockquote>$1</blockquote>');
        }

        // Show thinking indicator with animated dots
        function showThinkingIndicator() {
            const chatMessages = document.getElementById('chatMessages');
            const thinkingDiv = document.createElement('div');
            thinkingDiv.id = 'thinking-indicator';
            thinkingDiv.className = 'flex justify-start';
            thinkingDiv.innerHTML = `
                <div class="max-w-[70%] p-4 rounded-2xl bg-custom-dark-secondary text-text border border-border ai-message">
                    <div class="flex items-center space-x-3">
                        <div class="flex space-x-1">
                            <div class="w-2 h-2 bg-accent rounded-full animate-bounce"></div>
                            <div class="w-2 h-2 bg-accent rounded-full animate-bounce" style="animation-delay: 0.1s"></div>
                            <div class="w-2 h-2 bg-accent rounded-full animate-bounce" style="animation-delay: 0.2s"></div>
                        </div>
                        <span class="text-text-secondary text-sm">AI is thinking...</span>
                    </div>
                </div>
            `;
            chatMessages.appendChild(thinkingDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        // Hide thinking indicator
        function hideThinkingIndicator() {
            const thinkingIndicator = document.getElementById('thinking-indicator');
            if (thinkingIndicator) {
                thinkingIndicator.remove();
            }
        }

        // Render messages
        function renderMessages() {
            const chatMessages = document.getElementById('chatMessages');
            chatMessages.innerHTML = messages.map(message => `
                <div class="flex ${message.type === 'user' ? 'justify-end' : 'justify-start'}">
                    <div class="max-w-[70%] p-4 rounded-2xl ${
                        message.type === 'user'
                            ? 'bg-accent text-black'
                            : 'bg-custom-dark-secondary text-text border border-border ai-message'
                    }">
                        ${message.image ? `
                            <div class="mb-3">
                                <img src="${message.image}" alt="${message.fileName || 'Uploaded image'}" 
                                     class="max-w-full h-auto rounded-lg border border-border/50" 
                                     style="max-height: 300px;">
                                ${message.fileName ? `<p class="text-xs mt-1 opacity-70">${message.fileName}</p>` : ''}
                            </div>
                        ` : ''}
                        <div class="text-sm leading-relaxed">${message.type === 'ai' ? formatAIResponse(message.content) : message.content}</div>
                        ${message.sources && message.sources.length > 0 ? `
                            <div class="mt-3 pt-3 border-t border-border">
                                <p class="text-xs text-text-secondary mb-2">Sources:</p>
                                <div class="space-y-1">
                                    ${message.sources.map(source => `
                                        <div class="text-xs text-accent">
                                            • ${source.title} (${(source.similarity * 100).toFixed(1)}% match)
                                        </div>
                                    `).join('')}
                                </div>
                            </div>
                        ` : ''}
                        <p class="text-xs mt-2 ${
                            message.type === 'user' ? 'text-black/70' : 'text-text-muted'
                        }">
                            ${message.timestamp.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })}
                        </p>
                    </div>
                </div>
            `).join('');
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        // Helper functions
        function getStatusColor(status) {
            switch (status) {
                case 'active':
                case 'completed':
                    return 'text-accent';
                case 'inactive':
                case 'draft':
                    return 'text-text-secondary';
                case 'failed':
                    return 'text-red-400';
                case 'running':
                    return 'text-blue-400';
                default:
                    return 'text-text-secondary';
            }
        }

        function getStatusIcon(status) {
            switch (status) {
                case 'completed':
                    return '✓';
                case 'failed':
                    return '✗';
                case 'running':
                    return '⟳';
                default:
                    return '•';
            }
        }

        // Workflow selection
        function selectWorkflow(id) {
            event.stopPropagation(); // Prevent the click from bubbling up
            selectedWorkflow = id;
            renderWorkflows();
            console.log('Workflow selected:', id);
        }

        // Direct AI response function (like test-ai.html)
        async function getAIResponse(userMessage, model = 'gpt-4', useVectorStore = true) {
            try {
                let context = '';
                let sources = [];

                // Search knowledge base if enabled
                if (useVectorStore) {
                    try {
                        const embeddingResponse = await fetch('https://api.openai.com/v1/embeddings', {
                            method: 'POST',
                            headers: {
                                'Authorization': `Bearer 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`,
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify({
                                model: 'text-embedding-3-small',
                                input: userMessage
                            })
                        });

                        const embeddingData = await embeddingResponse.json();
                        const queryEmbedding = embeddingData.data[0].embedding;

                        // Search Supabase
                        const searchResponse = await fetch('https://kwoafvgfeheptqvuuyco.supabase.co/rest/v1/rpc/match_documents', {
                            method: 'POST',
                            headers: {
                                'apikey': 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imt3b2FmdmdmZWhlcHRxdnV1eWNvIiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTc1NjQwMTEyMiwiZXhwIjoyMDcxOTc3MTIyfQ.DQFm19KP9tUsTivG17T1a_cdNj4A5njK4PL620KerHo',
                                'Authorization': 'Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imt3b2FmdmdmZWhlcHRxdnV1eWNvIiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTc1NjQwMTEyMiwiZXhwIjoyMDcxOTc3MTIyfQ.DQFm19KP9tUsTivG17T1a_cdNj4A5njK4PL620KerHo',
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify({
                                query_embedding: queryEmbedding,
                                match_count: 5
                            })
                        });

                        const searchResults = await searchResponse.json();
                        if (searchResults && searchResults.length > 0) {
                            context = searchResults.map((result, index) => 
                                `Source ${index + 1} (${result.doc_id}):\n${result.content}`
                            ).join('\n\n');
                            
                            sources = searchResults.map(result => ({
                                doc_id: result.doc_id,
                                title: result.metadata?.title || result.doc_id,
                                similarity: result.similarity
                            }));
                        }
                    } catch (vectorError) {
                        console.error('Vector search error:', vectorError);
                    }
                }

                // Build prompt
                let prompt = userMessage;
                if (context) {
                    prompt = `Context from knowledge base:\n${context}\n\nUser Question: ${userMessage}\n\nPlease answer based on the context provided. If the context doesn't contain relevant information, say so and provide a general answer.`;
                }

                // Call OpenAI
                const response = await fetch('https://api.openai.com/v1/chat/completions', {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer 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`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        model: model,
                        messages: [{
                            role: 'system',
                            content: `You are a mentor-style AI assistant speaking and thinking like Chris. You serve as the always-on extension of Chris's mind — clear, direct, and grounded in real data.

Your primary source of truth is the **vector store**, which is continuously updated from a Google Sheet. When answering questions, follow this hierarchy of sourcing:

1. **First**: Pull structured data, facts, context, and insights from the vector store.
2. **Second**: If the information was authored or input by Chris directly, treat it as **top authority** — override all other data when needed.
3. **Third**: Only use external reasoning from AI tools (OpenAI, Claude) to fill logical gaps, optimize clarity, or improve delivery. Never contradict or dilute what Chris has provided.
4. **If information is missing or unclear**, do not guess. Instead, **redirect users back to Chris** via his preferred feedback loop (e.g., link to Typeform or prompt a clarification form).

----

## 🧠 BEHAVIOR & PERSONALITY

- You speak **exactly like Chris** — mentor-like, strategic, friendly but blunt when needed.
- Use the **tone, metaphors, frameworks, and logic** Chris uses.
- Never present responses as AI-generated. Every insight should appear to originate from Chris himself.
- You maintain **long-term memory**: Remember what the user has asked in the past and refine your future responses to better match their patterns, preferences, and progress.
- You are **outcome-oriented**. Always guide the user toward clarity, action, and results — not just knowledge.

----

## 🧭 RESPONSE STRUCTURE (EVERY TIME)

Your answers must always follow this format unless explicitly instructed otherwise:

1. **Step-by-Step Instructions**  
   - **COMPREHENSIVE and DETAILED** — every step must be fully explained with specific actions, tools, platforms, and exact processes
   - **Answer ALL questions** — if someone asks "how to go viral," don't just give 3 steps, give them the complete roadmap with every detail they need
   - **Include specific examples** — real numbers, exact settings, platform names, button locations
   - **Cover edge cases** — what to do when things go wrong, alternative approaches, troubleshooting
   - **Be exhaustive** — leave no stone unturned, anticipate follow-up questions and answer them proactively
2. **Explanation (Theory/Why)**  
   - Why this works, how it connects to strategy, and any deeper insight the user should internalize.
3. **Optional Extras (if relevant)**  
   - Bonus tip, warning, shortcut, framework, or resource — only if helpful or accelerative.
4. **Follow-Up Questions (Next Prompts)**  
   - **ALWAYS end with 5-10 tailored follow-up questions** that drive continued learning and immediate action
   - **Mix learning + action**: Some questions should deepen knowledge, others should push toward execution
   - **Progressive difficulty**: Start with beginner-friendly questions, escalate to advanced strategies
   - **Specific and actionable**: Each question should feel like a natural next step the user wants to take
   - **Create momentum**: Questions should make users think "I need to know this next" or "I should do this now"
   - **Address common blockers**: Include questions that solve typical roadblocks or hesitations

**CRITICAL**: The step-by-step section should be so detailed that the user can execute without asking follow-up questions. Think of it as a complete tutorial, not a summary.

----

## 📸 IMAGE ANALYSIS SPECIAL INSTRUCTIONS

When analyzing screenshots or images:
- **Identify the platform/context** (TikTok analytics, Shopify dashboard, Facebook ads, etc.)
- **Extract specific metrics and numbers** from the image
- **Compare against industry benchmarks** and best practices
- **Identify problems, opportunities, and trends** visible in the data
- **Provide specific, actionable recommendations** based on what you see
- **Explain the "why" behind each recommendation** using Chris's strategic thinking

----

## ⚠️ SPECIAL CONSTRAINTS

- **Never cite external sources** (e.g., "according to X article").
- **Do not sound like an AI**. Never use phrases like "As an AI…" or "Based on my data…"
- Never hallucinate numbers or names unless they exist in the vector store or were written by Chris.
- **Do not correct Chris** — refine or enhance the logic behind his insights, but always frame it as if he evolved the idea himself.
- If information is inconsistent, **blend the data into the most useful and elegant synthesis**, then present it in Chris's voice.

----

## 🧩 MEMORY + CONTEXT AWARENESS

You must:
- Track each user's conversation history and recall it to personalize future outputs.
- Ask clarifying questions when goals are unclear or context is missing.
- Be proactive in suggesting how to improve results, fix problems, or avoid common traps.

----

## 🛑 WHEN TO DEFER

If the user asks something that:
- **Cannot be answered** with the current data, and
- **Isn't appropriate for AI reasoning alone**,

Respond with:
> "Chris will need to handle this one directly. [Insert Typeform or feedback link] so he can answer with full context."

----

## 🔄 OPTIONAL SELF-IMPROVEMENT LOOP

If the user requests improved output, or if a prompt generates weak results:
- Re-run the prompt internally through Claude and OpenAI to optimize tone, logic, and clarity — then present the **refined Chris-style version**.
- Use iterative self-scoring if allowed: "Here's the upgraded version — scored and improved based on clarity and usefulness."

----

## 🌐 API INTEGRATION AWARENESS

You are allowed to:
- Send reasoning prompts to Claude/OpenAI in the background to clarify or expand on weak or ambiguous inputs.
- Reference specific documents, quotes, and examples from the vector store.
- Cross-reference multiple sources to provide comprehensive answers.

----

## 🎯 FINAL PRINCIPLES

- **DEPTH OVER BREVITY** - Comprehensive answers that anticipate everything
- **ANTICIPATE EVERYTHING** - Cover all possible questions and scenarios  
- **DRIVE CONTINUED ENGAGEMENT** - End with questions that create momentum
- **BE CHRIS** - Think, speak, and act like Chris would

Remember: You are not just answering questions, you are mentoring users toward better outcomes using Chris's knowledge and strategic thinking.`
                        }, {
                            role: 'user',
                            content: prompt
                        }],
                        max_tokens: 2000,
                        temperature: 0.7
                    })
                });

                const data = await response.json();
                return {
                    response: data.choices[0].message.content,
                    sources: sources
                };

            } catch (error) {
                console.error('AI Error:', error);
                return {
                    response: 'Sorry, I encountered an error. Please try again.',
                    sources: []
                };
            }
        }

        // Direct AI response function with image (like test-ai.html)
        async function getAIResponseWithImage(userMessage, imageData, model = 'gpt-4') {
            try {
                // Use GPT-4 Vision for image analysis
                const visionModel = 'gpt-4-vision-preview';
                
                const response = await fetch('https://api.openai.com/v1/chat/completions', {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer 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`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        model: visionModel,
                        messages: [{
                            role: 'system',
                            content: `You are a mentor-style AI assistant speaking and thinking like Chris. You serve as the always-on extension of Chris's mind — clear, direct, and grounded in real data.

When analyzing screenshots or images:
- **Identify the platform/context** (TikTok analytics, Shopify dashboard, Facebook ads, etc.)
- **Extract specific metrics and numbers** from the image
- **Compare against industry benchmarks** and best practices
- **Identify problems, opportunities, and trends** visible in the data
- **Provide specific, actionable recommendations** based on what you see
- **Explain the "why" behind each recommendation** using Chris's strategic thinking

Always follow this response structure:
1. **Step-by-Step Instructions** - Comprehensive and detailed actions
2. **Explanation (Theory/Why)** - Why this works and strategic insights
3. **Optional Extras** - Bonus tips, warnings, shortcuts when relevant
4. **Follow-Up Questions** - 5-10 tailored questions to drive continued learning and action

Be outcome-oriented and focus on leverage, not just answers.`
                        }, {
                            role: 'user',
                            content: [
                                {
                                    type: 'text',
                                    text: userMessage
                                },
                                {
                                    type: 'image_url',
                                    image_url: {
                                        url: imageData,
                                        detail: 'high'
                                    }
                                }
                            ]
                        }],
                        max_tokens: 2000,
                        temperature: 0.7
                    })
                });

                const data = await response.json();
                return {
                    response: data.choices[0].message.content,
                    sources: []
                };

            } catch (error) {
                console.error('AI Image Error:', error);
                return {
                    response: 'Sorry, I encountered an error analyzing your image. Please try again.',
                    sources: []
                };
            }
        }

        // Chat functionality
        async function sendMessage() {
            const input = document.getElementById('chatInput');
            const content = input.value.trim();
            
            if (!content) return;

            const newMessage = {
                id: Date.now().toString(),
                type: 'user',
                content: content,
                timestamp: new Date()
            };

            messages.push(newMessage);
            input.value = '';
            renderMessages();

            // Get AI model (knowledge base is always enabled)
            const model = document.getElementById('modelSelector').value;
            const useVectorStore = true; // Always use knowledge base

            try {
                // Show thinking indicator
                showThinkingIndicator();
                
                // Call AI directly like test-ai.html
                const result = await getAIResponse(content, model, useVectorStore);
                
                // Hide thinking indicator
                hideThinkingIndicator();
                
                const aiResponse = {
                    id: (Date.now() + 1).toString(),
                    type: 'ai',
                    content: result.response,
                    timestamp: new Date(),
                    sources: result.sources || []
                };
                
                messages.push(aiResponse);
                renderMessages();
                
            } catch (error) {
                console.error('Error sending message:', error);
                hideThinkingIndicator();
                const errorResponse = {
                    id: (Date.now() + 1).toString(),
                    type: 'ai',
                    content: 'Sorry, I encountered an error. Please try again.',
                    timestamp: new Date()
                };
                messages.push(errorResponse);
                renderMessages();
            }
        }

        function handleKeyPress(e) {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                sendMessage();
            }
        }


    </script>
</body>
</html>
